{% extends "base.html" %}
{% block title %}Matches · MTG Friends Trades{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-4">Matches</h1>
<p class="text-sm text-slate-400 mb-4">
  These are cards on your wishlist that your friends are currently offering for trade.
  <strong>Claim</strong> adds a card to your trade plan.
</p>

{% if matches %}
  <div class="space-y-5">
    {% for group in matches %}
      {% set w = group.wish %}
      <section class="bg-slate-800 rounded-lg p-4 border border-emerald-600/40">
        <h2 class="text-lg font-semibold mb-2">
          {{ w.card_name }}{% if w.set_name %} <span class="text-xs text-slate-400">({{ w.set_name }})</span>{% endif %}
        </h2>

        <div class="space-y-3">
          {% for item in group.offers %}
            {% set c = item.card %}
            {% set o = item.owner %}

            <div class="border border-slate-700 rounded-md p-2 bg-slate-900/60">
              <div class="flex gap-3 items-start">
                <!-- small image -->
                <div class="w-20">
                  {% if c.scryfall_image_url %}
                    <img src="{{ c.scryfall_image_url }}" alt="{{ c.card_name }}"
                         class="w-20 h-28 object-cover rounded border border-slate-700 cursor-pointer"
                         onclick="toggleDetails('match-card-details-{{ c.id }}')">
                  {% else %}
                    <div class="w-20 h-28 flex items-center justify-center rounded bg-slate-900 text-[10px] text-slate-500">
                      no image
                    </div>
                  {% endif %}
                </div>

                <!-- card info -->
                <div class="flex-1 text-sm">
                  <div class="font-semibold cursor-pointer"
                       onclick="toggleDetails('match-card-details-{{ c.id }}')">
                    {{ c.card_name }}
                  </div>
                  <div class="text-xs text-slate-400">
                    {% if c.set_name %}Set: {{ c.set_name }} · {% endif %}
                    Qty: {{ c.quantity }}{% if c.foil %} · Foil{% endif %}{% if c.condition %} · {{ c.condition }}{% endif %}
                  </div>
                  {% if c.price_usd %}
                    <div class="text-[11px] text-emerald-300 mt-0.5">
                      ~${{ "%.2f"|format(c.price_usd) }} each
                      {% if c.quantity > 1 %}
                        · total ~${{ "%.2f"|format(c.price_usd * c.quantity) }}
                      {% endif %}
                    </div>
                  {% endif %}
                  <div class="text-[11px] text-slate-500 mt-1">
                    From: {{ o.name }}
                  </div>
                </div>

                <!-- single small Claim button -->
                <div class="w-28 text-xs text-right">
                  <button
                    onclick="postClaim({{ c.id }})"
                    class="mt-1 px-2 py-1 rounded bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold text-[11px] w-full"
                  >
                    Claim
                  </button>
                </div>
              </div>

              {% if c.scryfall_image_url %}
                <div id="match-card-details-{{ c.id }}" class="hidden mt-3 border-t border-slate-700 pt-3">
                  <img src="{{ c.scryfall_image_url }}" alt="{{ c.card_name }}"
                       class="w-40 md:w-56 h-auto rounded-lg shadow-xl border border-slate-700 mb-2 mx-auto">
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </section>
    {% endfor %}
  </div>
{% else %}
  <p class="text-sm text-slate-400">
    No matches yet. Add some cards to your wishlist and ask your friends to import their collections.
  </p>
{% endif %}
{% endblock %}
